---
title: '방법: 사용자 지정 보안 토큰 인증자 만들기'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
ms.assetid: 10e245f7-d31e-42e7-82a2-d5780325d372
ms.openlocfilehash: df45f943da62624b92d483851e788dad0e240f47
ms.sourcegitcommit: af0a22a4eb11bbcd33baec49150d551955b50a16
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 02/14/2019
ms.locfileid: "56261130"
---
# <a name="how-to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="54866-102">방법: 사용자 지정 보안 토큰 인증자 만들기</span><span class="sxs-lookup"><span data-stu-id="54866-102">How to: create a custom security token authenticator</span></span>
<span data-ttu-id="54866-103">이 항목에서는 사용자 지정 보안 토큰 인증자를 만드는 방법과 이를 사용자 지정 보안 토큰 관리자와 통합하는 방법에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-103">This topic shows how to create a custom security token authenticator and how to integrate it with a custom security token manager.</span></span> <span data-ttu-id="54866-104">보안 토큰 인증자는 들어오는 메시지와 함께 제공된 보안 토큰 내용의 유효성을 검사합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-104">A security token authenticator validates the content of a security token provided with an incoming message.</span></span> <span data-ttu-id="54866-105">유효성 검사에 성공하면, 인증자는 평가 시 클레임 집합이 반환되는 <xref:System.IdentityModel.Policy.IAuthorizationPolicy> 인스턴스 컬렉션을 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-105">If the validation succeeds, the authenticator returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances that, when evaluated, returns a set of claims.</span></span>  
  
 <span data-ttu-id="54866-106">사용자 지정 보안 토큰 인증자를 Windows Communication Foundation (WCF)를 사용 하려면 먼저 만들어야 사용자 지정 자격 증명과 보안 토큰 관리자 구현 합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-106">To use a custom security token authenticator in Windows Communication Foundation (WCF), you must first create custom credentials and security token manager implementations.</span></span> <span data-ttu-id="54866-107">사용자 지정 자격 증명과 보안 토큰 관리자를 만드는 방법에 대 한 자세한 내용은 참조 하세요. [연습: 사용자 지정 클라이언트 및 서비스 자격 증명 만들기](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-107">For more information about creating custom credentials and a security token manager, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span>
  
## <a name="procedures"></a><span data-ttu-id="54866-108">절차</span><span class="sxs-lookup"><span data-stu-id="54866-108">Procedures</span></span>  
  
#### <a name="to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="54866-109">사용자 지정 보안 토큰 인증자를 만들려면</span><span class="sxs-lookup"><span data-stu-id="54866-109">To create a custom security token authenticator</span></span>  
  
1.  <span data-ttu-id="54866-110">
  <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> 클래스에서 파생된 새 클래스를 정의합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-110">Define a new class derived from the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> class.</span></span>  
  
2.  <span data-ttu-id="54866-111"><xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> 메서드를 재정의합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-111">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> method.</span></span> <span data-ttu-id="54866-112">사용자 지정 인증자가 들어오는 토큰 형식의 유효성을 검사할 수 있는지 여부에 따라 메서드에서 `true` 또는 `false`를 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-112">The method returns `true` or `false` depending on whether the custom authenticator can validate the incoming token type or not.</span></span>  
  
3.  <span data-ttu-id="54866-113"><xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> 메서드를 재정의합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-113">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> method.</span></span> <span data-ttu-id="54866-114">이 메서드는 토큰 내용의 유효성을 검사하는 데 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-114">This method needs to validate the token contents appropriately.</span></span> <span data-ttu-id="54866-115">토큰이 유효성 검사 단계를 통과하면 메서드가 <xref:System.IdentityModel.Policy.IAuthorizationPolicy> 인스턴스의 컬렉션을 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-115">If the token passes the validation step, it returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances.</span></span> <span data-ttu-id="54866-116">다음 예제에서는 다음 절차에서 만들 사용자 지정 권한 부여 정책 구현이 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="54866-116">The following example uses a custom authorization policy implementation that will be created in the next procedure.</span></span>  
  
     [!code-csharp[C_CustomTokenAuthenticator#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#1)]
     [!code-vb[C_CustomTokenAuthenticator#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#1)]  
  
 <span data-ttu-id="54866-117">이전 코드는 <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29> 메서드에서 권한 부여 정책 컬렉션을 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-117">The previous code returns a collection of authorization policies in the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29> method.</span></span> <span data-ttu-id="54866-118">WCF에는이 인터페이스의 공용 구현을 제공 하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="54866-118">WCF does not provide a public implementation of this interface.</span></span> <span data-ttu-id="54866-119">다음 절차에서는 사용자 요구 사항에 맞게 이를 수행하는 방법을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="54866-119">The following procedure shows how to do so for your own requirements.</span></span>  
  
#### <a name="to-create-a-custom-authorization-policy"></a><span data-ttu-id="54866-120">사용자 지정 권한 부여 정책을 만들려면</span><span class="sxs-lookup"><span data-stu-id="54866-120">To create a custom authorization policy</span></span>  
  
1.  <span data-ttu-id="54866-121">
  <xref:System.IdentityModel.Policy.IAuthorizationPolicy> 인터페이스를 구현하는 새 클래스를 정의합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-121">Define a new class implementing the <xref:System.IdentityModel.Policy.IAuthorizationPolicy> interface.</span></span>  
  
2.  <span data-ttu-id="54866-122">
  <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A> 읽기 전용 속성을 구현합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-122">Implement the <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A> read-only property.</span></span> <span data-ttu-id="54866-123">이 속성을 구현하는 한 가지 방법은 클래스 생성자로 GUID(Globally Unique Identifier)를 만든 다음 이 속성 값이 요청될 때마다 이를 반환하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="54866-123">One way to implement this property is to generate a globally unique identifier (GUID) in the class constructor and return it every time the value for this property is requested.</span></span>  
  
3.  <span data-ttu-id="54866-124">
  <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A> 읽기 전용 속성을 구현합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-124">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A> read-only property.</span></span> <span data-ttu-id="54866-125">이 속성은 토큰에서 가져오는 클레임 집합 발급자를 반환하는 데 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-125">This property needs to return an issuer of the claim sets that are obtained from the token.</span></span> <span data-ttu-id="54866-126">이 발급자는 토큰 발급자이거나 토큰 내용의 유효성을 검사하는 인증 기관이어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-126">This issuer should correspond to the issuer of the token or an authority that is responsible for validating the token contents.</span></span> <span data-ttu-id="54866-127">다음 예제에서는 이전 절차에서 만든 사용자 지정 보안 토큰 인증자로부터 이 클래스에 전달된 발급자 클레임을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-127">The following example uses the issuer claim that passed to this class from the custom security token authenticator created in the previous procedure.</span></span> <span data-ttu-id="54866-128">사용자 지정 보안 토큰 인증자는 <xref:System.IdentityModel.Claims.ClaimSet.System%2A> 속성을 통해 반환된 시스템 제공 클레임 집합을 사용하여, 사용자 이름 토큰의 발급자를 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="54866-128">The custom security token authenticator uses the system-provided claim set (returned by the <xref:System.IdentityModel.Claims.ClaimSet.System%2A> property) to represent the issuer of the username token.</span></span>  
  
4.  <span data-ttu-id="54866-129"><xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> 메서드를 구현합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-129">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> method.</span></span> <span data-ttu-id="54866-130">이 메서드는 인수로 전달된 <xref:System.IdentityModel.Policy.EvaluationContext> 클래스의 인스턴스를 들어오는 보안 토큰의 내용을 바탕으로 하는 클레임으로 채웁니다.</span><span class="sxs-lookup"><span data-stu-id="54866-130">This method populates an instance of the <xref:System.IdentityModel.Policy.EvaluationContext> class (passed in as an argument) with claims that are based on the incoming security token content.</span></span> <span data-ttu-id="54866-131">평가 시 이 작업이 완료되면 메서드는 `true`를 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-131">The method returns `true` when it is done with the evaluation.</span></span> <span data-ttu-id="54866-132">평가 컨텍스트에 추가 정보를 제공하는 다른 권한 부여 정책을 사용하여 구현하는 경우, 필요한 정보가 평가 컨텍스트에 아직 없으면 이 메서드는 `false`를 반환할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="54866-132">In cases when the implementation relies on the presence of other authorization policies that provide additional information to the evaluation context, this method can return `false` if the required information is not present yet in the evaluation context.</span></span> <span data-ttu-id="54866-133">이 경우 WCF는 하나 이상의 권한 부여 정책 평가 컨텍스트가 수정 하는 경우 들어오는 메시지에 대해 생성 된 다른 모든 권한 부여 정책을 평가한 후에 다시 메서드를 호출 합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-133">In that case, WCF will call the method again after evaluating all other authorization policies generated for the incoming message if at least one of those authorization policies modified the evaluation context.</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#3)]
     [!code-vb[c_CustomTokenAuthenticator#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#3)]  

 <span data-ttu-id="54866-134">[연습: 사용자 지정 클라이언트 및 서비스 자격 증명 만들기](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md) 사용자 지정 자격 증명 및 사용자 지정 보안 토큰 관리자를 만드는 방법을 설명 합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-134">[Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md) describes how to create custom credentials and a custom security token manager.</span></span> <span data-ttu-id="54866-135">여기에서 만든 사용자 지정 보안 토큰 인증자를 사용하기 위해 <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> 메서드에서 사용자 지정 인증자를 반환하도록 보안 토큰 관리자의 구현이 수정됩니다.</span><span class="sxs-lookup"><span data-stu-id="54866-135">To use the custom security token authenticator created here, an implementation of the security token manager is modified to return the custom authenticator from the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method.</span></span> <span data-ttu-id="54866-136">올바른 보안 토큰 요구 사항이 전달되면 메서드에서 인증자를 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-136">The method returns an authenticator when an appropriate security token requirement is passed in.</span></span>  
  
#### <a name="to-integrate-a-custom-security-token-authenticator-with-a-custom-security-token-manager"></a><span data-ttu-id="54866-137">사용자 지정 보안 토큰 인증자를 사용자 지정 보안 토큰 관리자와 통합하려면</span><span class="sxs-lookup"><span data-stu-id="54866-137">To integrate a custom security token authenticator with a custom security token manager</span></span>  
  
1.  <span data-ttu-id="54866-138">사용자 지정 보안 토큰 관리자 구현에서 <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> 메서드를 재정의합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-138">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method in your custom security token manager implementation.</span></span>  
  
2.  <span data-ttu-id="54866-139">메서드에 논리를 추가하여<xref:System.IdentityModel.Selectors.SecurityTokenRequirement> 매개 변수를 기반으로 사용자 지정 보안 토큰 인증자를 반환할 수 있도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-139">Add logic to the method to enable it to return your custom security token authenticator based on the <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> parameter.</span></span> <span data-ttu-id="54866-140">다음 예제에서는 토큰에서 요구하는 토큰 형식이 사용자 이름(<xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A> 속성으로 나타냄)이고 요청되는 보안 토큰 인증자에 대한 메시지 방향이 입력(<xref:System.ServiceModel.Description.MessageDirection.Input> 필드로 나타냄)이면 사용자 지정 보안 토큰 인증자를 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="54866-140">The following example returns a custom security token authenticator if the token requirements token type is a user name (represented by the <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A> property) and the message direction for which the security token authenticator is being requested is input (represented by the <xref:System.ServiceModel.Description.MessageDirection.Input> field).</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#2)]
     [!code-vb[c_CustomTokenAuthenticator#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#2)]  
 
## <a name="see-also"></a><span data-ttu-id="54866-141">참고자료</span><span class="sxs-lookup"><span data-stu-id="54866-141">See also</span></span>
- <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>
- <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>
- <xref:System.IdentityModel.Selectors.SecurityTokenManager>
- <xref:System.IdentityModel.Tokens.UserNameSecurityToken>
- [<span data-ttu-id="54866-142">연습: 사용자 지정 클라이언트 및 서비스 자격 증명 만들기</span><span class="sxs-lookup"><span data-stu-id="54866-142">Walkthrough: Creating Custom Client and Service Credentials</span></span>](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)
- [<span data-ttu-id="54866-143">방법: 사용자 지정 보안 토큰 공급자 만들기</span><span class="sxs-lookup"><span data-stu-id="54866-143">How to: Create a Custom Security Token Provider</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)
