---
title: 지속성 참석자
ms.date: 03/30/2017
ms.assetid: f84d2d5d-1c1b-4f19-be45-65b552d3e9e3
ms.openlocfilehash: 66178adda593192678542ebf5ed8906e0dffc908
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 01/23/2019
ms.locfileid: "54569507"
---
# <a name="persistence-participants"></a><span data-ttu-id="80af8-102">지속성 참석자</span><span class="sxs-lookup"><span data-stu-id="80af8-102">Persistence Participants</span></span>
<span data-ttu-id="80af8-103">지속성 참가자는 응용 프로그램 호스트에서 트리거된 지속성 작업(저장 또는 로드)에 참가할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-103">A persistence participant can participate in a persistence operation (Save or Load) triggered by an application host.</span></span> <span data-ttu-id="80af8-104">합니다 [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] 두 가지 추상 클래스와 함께 제공 되 **PersistenceParticipant** 하 고 **PersistenceIOParticipant**, 지 속성 참가자를 만드는 데 사용할 수 있는 합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-104">The [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] ships with two abstract classes, **PersistenceParticipant** and **PersistenceIOParticipant**, which you can use to create a persistence participant.</span></span> <span data-ttu-id="80af8-105">지속성 참가자는 이 클래스 중 하나에서 파생되고 관련 메서드를 구현한 다음 클래스의 인스턴스를 <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A>의 <xref:System.ServiceModel.Activities.WorkflowServiceHost> 컬렉션에 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-105">A persistence participant derives from one of these classes, implements the methods of interest, and then adds an instance of the class to the <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> collection on the <xref:System.ServiceModel.Activities.WorkflowServiceHost> .</span></span> <span data-ttu-id="80af8-106">응용 프로그램 호스트는 워크플로 인스턴스를 지속할 때 이 워크플로 확장을 검색하고 적당한 시간에 지속성 참가자에서 해당 메서드를 호출합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-106">The application host may look for such workflow extensions when persisting a workflow instance and invoke appropriate methods on the persistence participants at appropriate times.</span></span>  
  
 <span data-ttu-id="80af8-107">다음 목록에서는 유지(저장) 작업의 여러 단계에서 지속성 하위 시스템이 수행하는 작업을 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-107">The following list describes the tasks performed by the persistence subsystem in different stages of the Persist (Save) operation.</span></span> <span data-ttu-id="80af8-108">지속성 참가자는 세 번째 단계와 네 번째 단계에서 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-108">The persistence participants are used in the third and fourth stages.</span></span> <span data-ttu-id="80af8-109">참가자는 I/O 참가자 (또한 I/O 작업에 참여 하는 지 속성 참가자) 인 경우 참가자도 여섯 번째 단계에서 사용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-109">If the participant is an I/O participant (a persistence participant that also participates in I/O operations), the participant is also used in the sixth stage.</span></span>  
  
1.  <span data-ttu-id="80af8-110">워크플로 상태, 책갈피, 매핑된 변수 및 타임스탬프 등 기본 제공 값을 수집합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-110">Gathers built-in values, including workflow state, bookmarks, mapped variables, and timestamp.</span></span>  
  
2.  <span data-ttu-id="80af8-111">워크플로 인스턴스와 연결된 확장 수집에 추가된 모든 지속성 참가자를 수집합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-111">Gathers all persistence participants that were added to the extension collection associated with the workflow instance.</span></span>  
  
3.  <span data-ttu-id="80af8-112">모든 지속성 참가자에서 구현된 <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A> 메서드를 호출합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-112">Invokes the <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A> method implemented by all persistence participants.</span></span>  
  
4.  <span data-ttu-id="80af8-113">모든 지속성 참가자에서 구현된 <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A> 메서드를 호출합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-113">Invokes the <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A> method implemented by all persistence participants.</span></span>  
  
5.  <span data-ttu-id="80af8-114">워크플로를 지속성 저장소에 유지하거나 저장합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-114">Persist or save the workflow into the persistence store.</span></span>  
  
6.  <span data-ttu-id="80af8-115">호출 하 여 <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnSave%2A> 모든 I/O 지 속성 참가자에서 메서드.</span><span class="sxs-lookup"><span data-stu-id="80af8-115">Invokes the <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnSave%2A> method on all of the persistence I/O participants.</span></span> <span data-ttu-id="80af8-116">참가자를 I/O 참가자에 게 없는 경우이 작업을 건너뜁니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-116">If the participant is not an I/O participant, this task is skipped.</span></span> <span data-ttu-id="80af8-117">지속성 에피소드가 트랜잭션인 경우 이 트랜잭션은 Transaction.Current 속성에서 제공됩니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-117">If the persistence episode is transactional, the transaction is provided in Transaction.Current property.</span></span>  
  
7.  <span data-ttu-id="80af8-118">모든 지속성 참가자가 완료될 때까지 기다립니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-118">Waits for all persistence participants to complete.</span></span> <span data-ttu-id="80af8-119">모든 참가자가 인스턴스 데이터 유지에 성공하면 트랜잭션을 커밋합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-119">If all the participants succeed in persisting instance data, commits the transaction.</span></span>  
  
 <span data-ttu-id="80af8-120">지 속성 참가자에서 파생 되는 **PersistenceParticipant** 클래스를 구현할 수 있습니다 합니다 **CollectValues** 하 고 **MapValues** 메서드.</span><span class="sxs-lookup"><span data-stu-id="80af8-120">A persistence participant derives from the **PersistenceParticipant** class and may implement the **CollectValues** and **MapValues** methods.</span></span> <span data-ttu-id="80af8-121">I/O 지 속성 참가자에서 파생 되는 **PersistenceIOParticipant** 클래스를 구현할 수 있습니다 합니다 **BeginOnSave** 메서드를 구현 하는 것 외에도 **CollectValues**하 고 **MapValues** 메서드.</span><span class="sxs-lookup"><span data-stu-id="80af8-121">A persistence I/O participant derives from the **PersistenceIOParticipant** class and may implement the **BeginOnSave** method in addition to implementing the **CollectValues** and **MapValues** methods.</span></span>  
  
 <span data-ttu-id="80af8-122">각 단계는 다음 단계가 시작되기 전에 완료됩니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-122">Each stage is completed before the next stage begins.</span></span> <span data-ttu-id="80af8-123">값은 수집 하는 예를 들어 **모든** 지 속성 참가자에서 첫 번째 단계입니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-123">For example, values are collected from **all** persistence participants in the first stage.</span></span> <span data-ttu-id="80af8-124">두 번째 단계에서는 첫 번째 단계에서 수집한 모든 값을 모든 지속성 참가자에게 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-124">Then all the values collected in the first stage are provided to all persistence participants in the second stage for mapping.</span></span> <span data-ttu-id="80af8-125">세 번째 단계에서는 첫 번째 단계와 두 번째 단계에서 수집하고 매핑한 모든 값을 지속성 공급자에게 제공하며, 이후에도 같은 방식으로 계속됩니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-125">Then all the values collected and mapped in the first and second stages are provided to the persistence provider in the third stage, and so on.</span></span>  
  
 <span data-ttu-id="80af8-126">다음 목록에서는 로드 작업의 여러 단계에서 지속성 하위 시스템이 수행하는 작업을 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-126">The following list describes the tasks performed by the persistence subsystem in different stages of the Load operation.</span></span> <span data-ttu-id="80af8-127">지속성 참가자는 네 번째 단계에서 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-127">The persistence participants are used in the fourth stage.</span></span> <span data-ttu-id="80af8-128">지 속성 I/O 참가자 (또한 I/O 작업에 참여 하는 지 속성 참가자) 세 번째 단계 에서도 사용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-128">The persistence I/O participants (persistence participants that also participate in I/O operations) are also used in the third stage.</span></span>  
  
1.  <span data-ttu-id="80af8-129">워크플로 인스턴스와 연결된 확장 수집에 추가된 모든 지속성 참가자를 수집합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-129">Gathers all persistence participants that were added to the extension collection associated with the workflow instance.</span></span>  
  
2.  <span data-ttu-id="80af8-130">지속성 저장소에서 워크플로를 로드합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-130">Loads the workflow from the persistence store.</span></span>  
  
3.  <span data-ttu-id="80af8-131">호출 하 여 <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnLoad%2A> 모든 I/O 지 속성 참석자에 모든 지 속성 참가자가 완료 대기 합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-131">Invokes the <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnLoad%2A> on all persistence I/O participants and waits for all the persistence participants to complete.</span></span> <span data-ttu-id="80af8-132">지속성 에피소드가 트랜잭션인 경우 이 트랜잭션은 Transaction.Current에서 제공됩니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-132">If the persistence episode is transactional, the transaction is provided in Transaction.Current.</span></span>  
  
4.  <span data-ttu-id="80af8-133">지속성 저장소에서 검색한 데이터를 기반으로 메모리에 워크플로 인스턴스를 로드합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-133">Loads the workflow instance in memory based on the data retrieved from the persistence store.</span></span>  
  
5.  <span data-ttu-id="80af8-134">각 지속성 참가자에서 <xref:System.Activities.Persistence.PersistenceParticipant.PublishValues%2A>를 호출합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-134">Invokes <xref:System.Activities.Persistence.PersistenceParticipant.PublishValues%2A> on each persistence participant.</span></span>  
  
 <span data-ttu-id="80af8-135">지 속성 참가자에서 파생 된 **PersistenceParticipant** 클래스를 구현할 수 있습니다 합니다 **PublishValues** 메서드.</span><span class="sxs-lookup"><span data-stu-id="80af8-135">A persistence participant derives from the **PersistenceParticipant** class and may implement the **PublishValues** method.</span></span> <span data-ttu-id="80af8-136">I/O 지 속성 참가자에서 파생 되는 **PersistenceIOParticipant** 클래스를 구현할 수 있습니다 합니다 **BeginOnLoad** 메서드를 구현 하는 것 외에도 **PublishValues**메서드.</span><span class="sxs-lookup"><span data-stu-id="80af8-136">A persistence I/O participant derives from the **PersistenceIOParticipant** class and may implement the **BeginOnLoad** method in addition to implementing the **PublishValues** method.</span></span>  
  
 <span data-ttu-id="80af8-137">워크플로 인스턴스를 로드하면 지속성 공급자는 해당 인스턴스에 잠금을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-137">When loading a workflow instance the persistence provider creates a lock on that instance.</span></span> <span data-ttu-id="80af8-138">그러면 인스턴스가 다중 노드 시나리오에서 둘 이상의 호스트에 로드되는 것이 방지됩니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-138">This prevents the instance from being loaded by more than one host in a multi-node scenario.</span></span> <span data-ttu-id="80af8-139">잠겨 있는 워크플로 인스턴스를 로드 하려고 하면 다음과 같은 예외가 표시 됩니다. 예외 "System.ServiceModel.Persistence.InstanceLockException: 요청한 작업 때문에 완료할 수 없습니다 잠금을 예를 들어 ' 00000000-0000-0000-0000-000000000000' 획득할 수 없습니다 ".</span><span class="sxs-lookup"><span data-stu-id="80af8-139">If you attempt to load a workflow instance that has been locked you will see an exception like the following: The exception " System.ServiceModel.Persistence.InstanceLockException: The requested operation could not complete because the lock for instance '00000000-0000-0000-0000-000000000000' could not be acquired".</span></span> <span data-ttu-id="80af8-140">이 오류는 다음 중 하나가 발생하는 경우 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-140">This error is caused when one of the following occurs:</span></span>  
  
-   <span data-ttu-id="80af8-141">다중 노드 시나리오에서 인스턴스는 다른 호스트에 의해 로드됩니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-141">In a multi-node scenario the instance is loaded by another host.</span></span>  <span data-ttu-id="80af8-142">이러한 충돌 유형을 해결하는 방법은 몇 가지가 있습니다. 잠금을 소유하고 있는 노드에 처리를 전송하거나 다른 호스트가 해당 작업을 저장할 수 있도록 강제로 로드합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-142">There are a few different ways to resolve these types of conflicts: forward the processing to the node which owns the lock and retry, or force the load which will cause the other host to be unable to save their work.</span></span>  
  
-   <span data-ttu-id="80af8-143">단일 노드 시나리오에서는 호스트가 충돌합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-143">In a single-node scenario and the host crashed.</span></span>  <span data-ttu-id="80af8-144">호스트가 다시 시작되면(프로세스 재생 또는 새 지속성 공급자 팩터리 만들기) 새 호스트는 잠금이 아직 만료되지 않았기 때문에 기존 호스트가 아직 잠근 인스턴스를 로드하려고 시도합니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-144">When the host starts up again (a process recycle or creating a new persistence provider factory) the new host attempts to load an instance which is still locked by the old host because the lock hasn't expired yet.</span></span>  
  
-   <span data-ttu-id="80af8-145">단일 노드 시나리오에서는 해당 인스턴스가 어느 지점에서 중단되고 다른 호스트 ID를 가진 새 지속성 공급자가 만들어집니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-145">In a single-node scenario and the instance in question was aborted at some point and a new persistence provider instance is created which has a different host ID.</span></span>  
  
 <span data-ttu-id="80af8-146">잠금 시간 제한의 기본값은 5분이며 <xref:System.ServiceModel.Persistence.PersistenceProvider.Load%2A>를 호출할 때 다른 시간 제한 값을 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="80af8-146">The lock timeout value has a default value of 5 minutes, you can specify a different timeout value when calling <xref:System.ServiceModel.Persistence.PersistenceProvider.Load%2A>.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="80af8-147">섹션 내용</span><span class="sxs-lookup"><span data-stu-id="80af8-147">In This Section</span></span>  
  
-   [<span data-ttu-id="80af8-148">방법: 사용자 지정 지 속성 참석자 만들기</span><span class="sxs-lookup"><span data-stu-id="80af8-148">How to: Create a Custom Persistence Participant</span></span>](../../../docs/framework/windows-workflow-foundation/how-to-create-a-custom-persistence-participant.md)  
  
## <a name="see-also"></a><span data-ttu-id="80af8-149">참고자료</span><span class="sxs-lookup"><span data-stu-id="80af8-149">See also</span></span>
- [<span data-ttu-id="80af8-150">저장소 확장성</span><span class="sxs-lookup"><span data-stu-id="80af8-150">Store Extensibility</span></span>](../../../docs/framework/windows-workflow-foundation/store-extensibility.md)
