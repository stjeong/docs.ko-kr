---
title: 인증을 위해 서비스 ID 재정의
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: d613a22b-07d7-41a4-bada-1adc653b9b5d
ms.openlocfilehash: 8c0807a7b811cf2cb3a13576018373d135e3e5cd
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 01/23/2019
ms.locfileid: "54554467"
---
# <a name="overriding-the-identity-of-a-service-for-authentication"></a><span data-ttu-id="39fdb-102">인증을 위해 서비스 ID 재정의</span><span class="sxs-lookup"><span data-stu-id="39fdb-102">Overriding the Identity of a Service for Authentication</span></span>
<span data-ttu-id="39fdb-103">일반적으로 선택한 클라이언트 자격 증명 형식에 따라 서비스 메타데이터에 노출되는 ID 형식이 결정되므로 서비스에 ID를 설정할 필요가 없습니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-103">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="39fdb-104">예를 들어 다음 구성 코드에서는 합니다 [ \<wsHttpBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) 요소 집합과 `clientCredentialType` Windows 특성.</span><span class="sxs-lookup"><span data-stu-id="39fdb-104">For example, the following configuration code uses the [\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) element and sets the `clientCredentialType` attribute to Windows.</span></span>  
  
  
  
 <span data-ttu-id="39fdb-105">다음 WSDL(웹 서비스 기술 언어) 단편에서는 이전에 정의한 엔드포인트의 ID를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-105">The following Web Services Description Language (WSDL) fragment shows the identity for the endpoint previously defined.</span></span> <span data-ttu-id="39fdb-106">이 예제에서는 특정 사용자 계정으로 자체 호스팅 서비스로 서비스 중인지 (username@contoso.com) 한 사용자 계정 이름 (UPN) id의 계정 이름을 포함 합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-106">In this example, the service is running as a self-hosted service under a particular user account (username@contoso.com) and therefore the user principal name (UPN) identity contains the account name.</span></span> <span data-ttu-id="39fdb-107">UPN을 Windows 도메인의 사용자 로그온 이름이라고도 합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-107">The UPN is also known as the user logon name in a Windows domain.</span></span>  
  
  
  
 <span data-ttu-id="39fdb-108">Id 설정을 보여 주는 샘플 응용 프로그램을 참조 하세요 [Service Identity 샘플](../../../../docs/framework/wcf/samples/service-identity-sample.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-108">For a sample application that demonstrates identity setting, see [Service Identity Sample](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span></span> <span data-ttu-id="39fdb-109">서비스 id에 대 한 자세한 내용은 참조 하세요. [서비스 Id 및 인증](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-109">For more information about service identity, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
## <a name="kerberos-authentication-and-identity"></a><span data-ttu-id="39fdb-110">Kerberos 인증 및 ID</span><span class="sxs-lookup"><span data-stu-id="39fdb-110">Kerberos Authentication and Identity</span></span>  
 <span data-ttu-id="39fdb-111">기본적으로 서비스는 Windows 자격 증명을 사용 하도록 구성 된 경우는 [ \<identity >](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) 포함 하는 요소는 [ \<userPrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) 또는 [ \<servicePrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) 요소가 WSDL에서 생성 됩니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-111">By default, when a service is configured to use a Windows credential, an [\<identity>](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) element that contains a [\<userPrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) or [\<servicePrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) element is generated in the WSDL.</span></span> <span data-ttu-id="39fdb-112">서비스를 실행 하는 경우는 `LocalSystem`, `LocalService`, 또는 `NetworkService` 계정, 서비스 사용자 이름 (SPN)의 형태로 기본적으로 생성 됩니다 `host/` \< *hostname*> 때문에 이러한 계정이 컴퓨터의 SPN 데이터에 액세스할을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-112">If the service is running under the `LocalSystem`, `LocalService`, or `NetworkService` account, a service principal name (SPN) is generated by default in the form of `host/`\<*hostname*> because those accounts have access to the computer's SPN data.</span></span> <span data-ttu-id="39fdb-113">Windows Communication Foundation (WCF)의 형태로 UPN을 생성 서비스를 다른 계정으로 실행 하는 경우 \< *사용자 이름*>@<*domainName* `>` .</span><span class="sxs-lookup"><span data-stu-id="39fdb-113">If the service is running under a different account, Windows Communication Foundation (WCF) generates a UPN in the form of \<*username*>@<*domainName*`>`.</span></span> <span data-ttu-id="39fdb-114">Kerberos 인증에서 서비스를 인증하려면 UPN 또는 SPN을 클라이언트에 제공해야 하므로 이 작업이 수행됩니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-114">This occurs because Kerberos authentication requires that a UPN or SPN be supplied to the client to authenticate the service.</span></span>  
  
 <span data-ttu-id="39fdb-115">Setspn.exe 도구를 사용하여 도메인의 서비스 계정으로 추가 SPN을 등록할 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-115">You can also use the Setspn.exe tool to register an additional SPN with a service's account in a domain.</span></span> <span data-ttu-id="39fdb-116">그런 다음 SPN을 서비스 ID로 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-116">You can then use the SPN as the identity of the service.</span></span> <span data-ttu-id="39fdb-117">이 도구를 다운로드 하려면 참조 [Windows 2000 Resource Kit Tool: Setspn.exe](https://go.microsoft.com/fwlink/?LinkId=91752).</span><span class="sxs-lookup"><span data-stu-id="39fdb-117">To download the tool, see [Windows 2000 Resource Kit Tool : Setspn.exe](https://go.microsoft.com/fwlink/?LinkId=91752).</span></span> <span data-ttu-id="39fdb-118">도구에 대 한 자세한 내용은 참조 하세요. [Setspn 개요](https://go.microsoft.com/fwlink/?LinkId=61374)합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-118">For more information about the tool, see [Setspn Overview](https://go.microsoft.com/fwlink/?LinkId=61374).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="39fdb-119">Windows 자격 증명 형식을 협상 없이 사용하려면 서비스의 사용자 계정이 Active Directory 도메인에 등록된 SPN에 대한 액세스 권한이 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-119">To use the Windows credential type without negotiation, the service's user account must have access to the SPN that is registered with the Active Directory domain.</span></span> <span data-ttu-id="39fdb-120">다음과 같은 방법으로 이 작업을 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-120">You can do this in the following ways:</span></span>  
  
-   <span data-ttu-id="39fdb-121">NetworkService 또는 LocalSystem 계정을 사용하여 서비스를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-121">Use the NetworkService or LocalSystem account to run your service.</span></span> <span data-ttu-id="39fdb-122">해당 계정에 컴퓨터 시스템을 Active Directory 도메인에 연결할 때 설정 된 SPN에는 액세스할 수 있으므로 WCF 서비스의 메타 데이터 (WSDL)에서 서비스의 끝점 내에서 적절 한 SPN 요소를 자동으로 생성 합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-122">Because those accounts have access to the machine SPN that is established when the machine joins the Active Directory domain, WCF automatically generates the proper SPN element inside the service's endpoint in the service's metadata (WSDL).</span></span>  
  
-   <span data-ttu-id="39fdb-123">임의의 Active Directory 도메인 계정을 사용하여 서비스를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-123">Use an arbitrary Active Directory domain account to run your service.</span></span> <span data-ttu-id="39fdb-124">이 경우 해당 도메인 계정의 SPN을 설정합니다. Setspn.exe 유틸리티 도구를 사용하여 이 작업을 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-124">In this case, establish an SPN for that domain account, which you can do by using the Setspn.exe utility tool.</span></span> <span data-ttu-id="39fdb-125">서비스의 계정에 대 한 SPN을 만든 후 메타 데이터 (WSDL)를 통해 서비스 클라이언트에 SPN을 게시 하는 WCF를 구성 합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-125">Once you create the SPN for the service's account, configure WCF to publish that SPN to the service's clients through its metadata (WSDL).</span></span> <span data-ttu-id="39fdb-126">이 작업은 응용 프로그램 구성 파일이나 코드를 통해 노출된 엔드포인트에 대한 엔드포인트 ID를 설정하여 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-126">This is done by setting the endpoint identity for the exposed endpoint, either through an application configuration file or code.</span></span>  
  
 <span data-ttu-id="39fdb-127">Spn에 대 한 자세한 정보, Kerberos 프로토콜 및 Active Directory에 대 한 참조 [Kerberos 기술 보완에 대 한 Windows](https://go.microsoft.com/fwlink/?LinkId=88330)합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-127">For more information about SPNs, the Kerberos protocol, and Active Directory, see [Kerberos Technical Supplement for Windows](https://go.microsoft.com/fwlink/?LinkId=88330).</span></span>  
  
### <a name="when-spn-or-upn-equals-the-empty-string"></a><span data-ttu-id="39fdb-128">SPN 또는 UPN이 빈 문자열인 경우</span><span class="sxs-lookup"><span data-stu-id="39fdb-128">When SPN or UPN Equals the Empty String</span></span>  
 <span data-ttu-id="39fdb-129">SPN 또는 UPN을 빈 문자열과 같게 설정하면 사용되는 보안 수준과 인증 모드에 따라 다른 많은 작업이 수행됩니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-129">If you set the SPN or UPN equal to an empty string, a number of different things happen, depending on the security level and authentication mode being used:</span></span>  
  
-   <span data-ttu-id="39fdb-130">전송 수준 보안을 사용하는 경우 NTLM(NT LanMan) 인증이 선택됩니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-130">If you are using transport level security, NT LanMan (NTLM) authentication is chosen.</span></span>  
  
-   <span data-ttu-id="39fdb-131">메시지 수준 보안을 사용하는 경우 인증 모드에 따라 인증이 실패할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-131">If you are using message level security, authentication may fail, depending on the authentication mode:</span></span>  
  
-   <span data-ttu-id="39fdb-132">`spnego` 모드를 사용하고 `AllowNtlm` 특성이 `false`로 설정된 경우 인증이 실패합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-132">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `false`, authentication fail.</span></span>  
  
-   <span data-ttu-id="39fdb-133">`spnego` 모드를 사용하고 `AllowNtlm` 특성이 `true`로 설정된 경우 UPN이 비어 있으면 인증이 실패하지만 SPN이 비어 있으면 성공합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-133">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `true`, authentication fails if the UPN is empty, but succeeds if the SPN is empty.</span></span>  
  
-   <span data-ttu-id="39fdb-134">"단일 쇼트"라고도 하는 Kerberos direct를 사용하는 경우 인증이 실패합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-134">If you are using Kerberos direct (also known as "one-shot"), authentication fails.</span></span>  
  
### <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="39fdb-135">사용 하 여 \<identity > 구성에서 요소</span><span class="sxs-lookup"><span data-stu-id="39fdb-135">Using the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="39fdb-136">이전에 Certificate에 표시된 바인딩에서 클라이언트 자격 증명 형식을 변경하면`,` 생성된 WSDL에 다음 코드에 표시된 ID 값에 대한 Base64로 serialize된 X.509 인증서가 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-136">If you change the client credential type in the binding previously shown to Certificate`,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="39fdb-137">이는 Windows 이외의 모든 클라이언트 자격 증명 형식에 대한 기본값입니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-137">This is the default for all client credential types other than Windows.</span></span>  
  
  
  
 <span data-ttu-id="39fdb-138">구성에 <`identity`> 요소를 사용하거나 코드에서 ID를 설정하여 기본 서비스 ID의 값을 변경하거나 ID 형식을 변경할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-138">You can change the value of the default service identity or change the type of the identity by using the <`identity`> element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="39fdb-139">다음 구성 코드에서는 값 `contoso.com`으로 DNS(Domain Name System) ID를 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-139">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  
  
  
  
### <a name="setting-identity-programmatically"></a><span data-ttu-id="39fdb-140">프로그래밍 방식으로 ID 설정</span><span class="sxs-lookup"><span data-stu-id="39fdb-140">Setting Identity Programmatically</span></span>  
 <span data-ttu-id="39fdb-141">서비스가 없습니다 identity (id)를 명시적으로 지정 하려면 WCF가 자동으로 결정 되기 때문에.</span><span class="sxs-lookup"><span data-stu-id="39fdb-141">Your service does not have to explicitly specify an identity, because WCF automatically determines it.</span></span> <span data-ttu-id="39fdb-142">그러나 WCF 허용 필요한 경우 끝점에서 id를 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-142">However, WCF allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="39fdb-143">다음 코드에서는 특정 DNS ID를 사용하여 새 서비스 엔드포인트를 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="39fdb-143">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="see-also"></a><span data-ttu-id="39fdb-144">참고자료</span><span class="sxs-lookup"><span data-stu-id="39fdb-144">See also</span></span>
- [<span data-ttu-id="39fdb-145">방법: 사용자 지정 클라이언트 Id 검증 도구 만들기</span><span class="sxs-lookup"><span data-stu-id="39fdb-145">How to: Create a Custom Client Identity Verifier</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md)
- [<span data-ttu-id="39fdb-146">서비스 ID 및 인증</span><span class="sxs-lookup"><span data-stu-id="39fdb-146">Service Identity and Authentication</span></span>](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)
